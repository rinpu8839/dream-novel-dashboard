<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>å¤¢å°èª¬å‰µä½œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - æ”¹å–„ç‰ˆ</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 10px;
    overflow-x: hidden;
}

/* ã‚¿ãƒƒãƒãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ”¹å–„ */
button, .clickable, .task-title, .genre-tab, .memo-tab, input[type="checkbox"] {
    cursor: pointer;
    transition: all 0.2s ease;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

button:active, .clickable:active {
    transform: scale(0.95);
    opacity: 0.8;
}

button:hover, .clickable:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.task-title:hover {
    color: #667eea;
    text-decoration: underline;
}

/* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®è¦–è¦šæ”¹å–„ */
input[type="checkbox"] {
    width: 24px;
    height: 24px;
    cursor: pointer;
    position: relative;
}

input[type="checkbox"]:checked::after {
    content: 'âœ“';
    position: absolute;
    top: 0;
    left: 4px;
    font-size: 18px;
    color: #48bb78;
    animation: checkmark 0.3s ease;
}

@keyframes checkmark {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.title {
    font-size: 24px;
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ã‚¸ãƒ£ãƒ³ãƒ«é–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.genre-tab {
    padding: 10px 20px;
    background: #f0f0f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.genre-tab.active {
    background: #667eea;
    color: white;
    transform: scale(1.05);
}

.genre-tab .sparkle {
    position: absolute;
    top: -5px;
    right: -5px;
    font-size: 16px;
    animation: sparkle 1.5s infinite;
}

@keyframes sparkle {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

.genre-edit-btn {
    margin-left: 5px;
    padding: 2px 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
}

/* ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰æ”¹å–„ */
.task-card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    position: relative;
}

.task-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.task-card.r18 {
    background: linear-gradient(135deg, #fff 0%, #ffe0e0 100%);
    border-left: 5px solid #ff69b4;
}

.task-card.priority {
    border-top: 3px solid #ffd700;
}

.priority-crown {
    color: #ffd700;
    font-size: 18px;
    margin-right: 5px;
}

.task-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    padding: 5px;
    border-radius: 5px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
}

/* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼æ”¹å–„ */
.progress-container {
    margin: 10px 0;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 5px;
}

.progress-text {
    color: white;
    font-size: 12px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

/* ã‚µãƒ–ã‚¿ã‚¹ã‚¯æ”¹å–„ */
.subtask-container {
    background: #f9f9f9;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
}

.subtask-item {
    display: flex;
    align-items: center;
    padding: 8px;
    margin: 5px 0;
    background: white;
    border-radius: 5px;
    transition: all 0.2s ease;
}

.subtask-item:hover {
    background: #f0f9ff;
    transform: translateX(5px);
}

.subtask-item.completed {
    opacity: 0.6;
    text-decoration: line-through;
}

/* ãƒ¡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ */
.memo-item {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.memo-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
}

.memo-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;
}

.memo-preview {
    color: #666;
    font-size: 14px;
    line-height: 1.4;
    max-height: 3em;
    overflow: hidden;
    text-overflow: ellipsis;
}

.memo-item.expanded .memo-preview {
    max-height: none;
}

/* ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼æ”¹å–„ */
.pomodoro-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.pomodoro-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.pomodoro-btn.start {
    background: #48bb78;
    color: white;
}

.pomodoro-btn.pause {
    background: #ed8936;
    color: white;
}

.pomodoro-btn.reset {
    background: #f56565;
    color: white;
}

/* ä»Šæ—¥ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ */
.daily-sequence {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.sequence-bar {
    display: flex;
    gap: 2px;
    height: 30px;
    border-radius: 5px;
    overflow: hidden;
}

.sequence-segment {
    flex: 1;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.3s ease;
}

.sequence-segment.completed {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
}

/* ãƒãƒ“ãƒƒãƒˆãƒˆãƒ©ãƒƒã‚«ãƒ¼ */
.habit-tracker {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
}

.habit-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 15px;
}

.habit-cell {
    aspect-ratio: 1;
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.habit-cell.analysis {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.habit-cell.creation {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
}

/* æœˆé–“äºˆå®šè¡¨ç¤º */
.monthly-schedule {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease;
}

.monthly-schedule.expanded {
    max-height: 1000px;
}

.schedule-toggle {
    background: #667eea;
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
}

/* é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 10px;
    padding: 15px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 10000;
    animation: slideIn 0.5s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.notification.success {
    border-left: 5px solid #48bb78;
}

.notification.error {
    border-left: 5px solid #f56565;
}

/* ç›®æ¨™è¨­å®š */
.goal-setting {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.goal-input {
    width: 100%;
    padding: 10px;
    border: 2px solid white;
    border-radius: 8px;
    font-size: 14px;
    margin-top: 10px;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«æ”¹å–„ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: white;
    border-radius: 15px;
    padding: 25px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    animation: scaleIn 0.3s ease;
}

@keyframes scaleIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .title {
        font-size: 20px;
    }
    
    .genre-tab {
        padding: 8px 12px;
        font-size: 14px;
    }
    
    .task-card {
        padding: 12px;
    }
}

/* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-success {
    background: #48bb78;
    color: white;
}

.btn-danger {
    background: #f56565;
    color: white;
}

.btn-warning {
    background: #ed8936;
    color: white;
}

.btn:active {
    transform: scale(0.95);
}

/* ã‚¿ã‚°ã‚·ã‚¹ãƒ†ãƒ  */
.tag {
    display: inline-block;
    padding: 4px 10px;
    background: #e3f2fd;
    color: #1976d2;
    border-radius: 15px;
    font-size: 12px;
    margin: 2px;
}

.tag.r18 {
    background: #ffe0e0;
    color: #ff69b4;
    font-weight: bold;
}

/* åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
.analysis-section {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
}

.analysis-chart {
    height: 200px;
    background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
    border-radius: 10px;
    display: flex;
    align-items: flex-end;
    padding: 10px;
    gap: 5px;
}

.chart-bar {
    flex: 1;
    background: linear-gradient(to top, #667eea, #764ba2);
    border-radius: 5px 5px 0 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    color: white;
    font-size: 10px;
    padding-bottom: 5px;
}

.chart-bar:hover {
    transform: scaleY(1.1);
}

input[type="text"], input[type="date"], input[type="number"], select, textarea {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #667eea;
}

textarea {
    resize: vertical;
    min-height: 100px;
}
</style>
</head>
<body>

<div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <div class="title">
            <span>âœ¨</span>
            <span>å¤¢å°èª¬å‰µä½œãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </div>
        
        <!-- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ï¼†ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ -->
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin: 20px 0;">
            <div>
                <div style="font-size: 14px; color: #666;">ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³</div>
                <div class="progress-bar" style="width: 200px;">
                    <div class="progress-fill" id="motivationBar" style="width: 75%;">
                        <span class="progress-text">75%</span>
                    </div>
                </div>
                <div id="motivationText" style="font-size: 12px; color: #888; margin-top: 5px;">â­ ã„ã„æ„Ÿã˜ï¼</div>
            </div>
            
            <div style="background: #ffe0f0; padding: 10px 20px; border-radius: 25px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ğŸ…</span>
                    <span id="pomodoroTime" style="font-size: 20px; font-weight: bold;">25:00</span>
                    <div class="pomodoro-controls">
                        <button class="pomodoro-btn start" id="pomodoroStart" onclick="startPomodoro()">é–‹å§‹</button>
                        <button class="pomodoro-btn pause" id="pomodoroPause" onclick="pausePomodoro()" style="display: none;">ä¸€æ™‚åœæ­¢</button>
                        <button class="pomodoro-btn reset" onclick="resetPomodoro()">ãƒªã‚»ãƒƒãƒˆ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ãƒ– -->
        <div id="genreTabs" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <button class="btn btn-success" onclick="showAddGenreModal()" style="margin-top: 10px;">
            + ã‚¸ãƒ£ãƒ³ãƒ«è¿½åŠ 
        </button>
    </div>
    
    <!-- ç›®æ¨™è¨­å®š -->
    <div class="goal-setting">
        <h3 style="color: #333; margin-bottom: 10px;">ğŸ¯ ä»Šæ—¥ã®ç›®æ¨™</h3>
        <input type="text" class="goal-input" id="dailyGoal" placeholder="ä¾‹: TRICKç¬¬1ç« ã‚’å®Œæˆã•ã›ã‚‹" onchange="saveDailyGoal()">
        <div style="margin-top: 10px;">
            <h4 style="color: #333; font-size: 14px;">ä»Šæœˆã®ç›®æ¨™</h4>
            <input type="text" class="goal-input" id="monthlyGoal" placeholder="ä¾‹: å¤¢å°èª¬ã‚’3ä½œå“å®Œæˆ" onchange="saveMonthlyGoal()">
        </div>
    </div>
    
    <!-- ä»Šæ—¥ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ -->
    <div class="daily-sequence">
        <h3 style="color: #333; margin-bottom: 10px;">ğŸ“Š ä»Šæ—¥ã®é€²æ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</h3>
        <div class="sequence-bar" id="dailySequence">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <div style="margin-top: 10px; font-size: 14px; color: #666;">
            å®Œäº†: <span id="completedToday">0</span> / <span id="totalToday">0</span> ã‚¿ã‚¹ã‚¯
        </div>
    </div>
    
    <!-- æœˆé–“äºˆå®š -->
    <button class="schedule-toggle" onclick="toggleMonthlySchedule()">
        ğŸ“… 1ãƒ¶æœˆã®äºˆå®šã‚’è¡¨ç¤º
    </button>
    <div class="monthly-schedule" id="monthlySchedule">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
    </div>
    
    <!-- AIæ¨å¥¨ã‚¿ã‚¹ã‚¯ -->
    <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
        <h3 style="margin-bottom: 10px;">ğŸ¤– AIæ¨å¥¨: å„ªå…ˆã‚¿ã‚¹ã‚¯</h3>
        <div id="aiAdvice">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>
    
    <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
    <div id="taskList">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
    </div>
    
    <!-- ãƒãƒ“ãƒƒãƒˆãƒˆãƒ©ãƒƒã‚«ãƒ¼ -->
    <div class="habit-tracker">
        <h3 style="color: #333; margin-bottom: 10px;">ğŸ“ˆ ç¿’æ…£åŒ–ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h3>
        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 3px;"></div>
                <span style="font-size: 14px;">åˆ†æä½œæ¥­</span>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 3px;"></div>
                <span style="font-size: 14px;">å‰µä½œä½œæ¥­</span>
            </div>
        </div>
        <div class="habit-grid" id="habitGrid">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>
    
    <!-- ãƒ¡ãƒ¢ã‚·ã‚¹ãƒ†ãƒ  -->
    <div style="background: white; border-radius: 15px; padding: 20px; margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="color: #333;">ğŸ’¡ ã‚¢ã‚¤ãƒ‡ã‚¢ãƒ¡ãƒ¢</h3>
            <button class="btn btn-primary" onclick="showMemoModal()">
                + æ–°è¦ãƒ¡ãƒ¢
            </button>
        </div>
        <div id="memoList">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
    </div>
    
    <!-- åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div class="analysis-section">
        <h3 style="color: #333; margin-bottom: 15px;">ğŸ“Š ä½œæ¥­åˆ†æ</h3>
        <div class="analysis-chart" id="analysisChart">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <div id="analysisAdvice" style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px; font-size: 14px;">
            <!-- AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ -->
        </div>
    </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç¾¤ -->

<!-- ã‚¸ãƒ£ãƒ³ãƒ«è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="genreModal" class="modal">
    <div class="modal-content">
        <h3 id="genreModalTitle">ã‚¸ãƒ£ãƒ³ãƒ«è¿½åŠ </h3>
        <input type="text" id="genreName" placeholder="ã‚¸ãƒ£ãƒ³ãƒ«åã‚’å…¥åŠ›">
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveGenre()">ä¿å­˜</button>
            <button class="btn" onclick="closeModal('genreModal')" style="background: #ccc;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
</div>

<!-- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <h3 id="taskModalTitle">ã‚¿ã‚¹ã‚¯è¿½åŠ </h3>
        <input type="text" id="taskTitle" placeholder="ã‚¿ã‚¹ã‚¯å">
        <select id="taskType">
            <option value="transcript">ã‚»ãƒªãƒ•èµ·ã“ã—</option>
            <option value="analysis">åˆ†æ</option>
            <option value="planning">ä¼ç·šå±•é–‹ãƒ•ã‚¡ã‚¤ãƒ«</option>
            <option value="writing">å¤¢å°èª¬åŸ·ç­†</option>
        </select>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">ç« æ§‹æˆï¼ˆåŸ·ç­†ã®å ´åˆï¼‰</label>
            <input type="number" id="chapterCount" value="3" min="1" max="10">
        </div>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">1è©±ã‚ãŸã‚Šã®æ–‡å­—æ•°</label>
            <input type="number" id="wordsPerEpisode" value="8000" min="1000">
        </div>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">ã‚¿ã‚°</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 5px;">
                <label><input type="checkbox" id="tagR18"> R-18</label>
                <label><input type="checkbox" id="tagRomance"> æ‹æ„›</label>
                <label><input type="checkbox" id="tagAction"> ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</label>
                <label><input type="checkbox" id="tagComedy"> ã‚³ãƒ¡ãƒ‡ã‚£</label>
            </div>
        </div>
        
        <input type="date" id="taskStartDate">
        <input type="date" id="taskEndDate">
        <textarea id="taskDetails" placeholder="è©³ç´°ï¼ˆã‚µãƒ–ã‚¿ã‚¹ã‚¯ã¯æ”¹è¡Œã§åŒºåˆ‡ã‚‹ï¼‰"></textarea>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveTask()">ä¿å­˜</button>
            <button class="btn" onclick="closeModal('taskModal')" style="background: #ccc;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
</div>

<!-- ã‚¿ã‚¹ã‚¯è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <h3 id="detailTitle">ã‚¿ã‚¹ã‚¯è©³ç´°</h3>
        <div id="detailContent">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
        </div>
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center; font-style: italic;">
            <div id="motivationalQuote"></div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="startTaskWork()">ä½œæ¥­é–‹å§‹</button>
            <button class="btn" onclick="closeModal('detailModal')" style="background: #ccc;">é–‰ã˜ã‚‹</button>
        </div>
    </div>
</div>

<!-- ãƒ¡ãƒ¢è¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="memoModal" class="modal">
    <div class="modal-content">
        <h3 id="memoModalTitle">ãƒ¡ãƒ¢ä½œæˆ</h3>
        <input type="text" id="memoTitle" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
        <textarea id="memoContent" placeholder="å†…å®¹"></textarea>
        <select id="memoGenre">
            <option value="">ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ</option>
        </select>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveMemo()">ä¿å­˜</button>
            <button class="btn" onclick="closeModal('memoModal')" style="background: #ccc;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
</div>

<script>
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
let tasks = {};
let genres = [];
let memos = [];
let dailyProgress = {};
let pomodoroTime = 25 * 60;
let pomodoroActive = false;
let pomodoroInterval = null;
let currentTaskId = null;
let currentEditGenreId = null;
let currentEditMemoId = null;
let motivationLevel = 75;

// åˆæœŸåŒ–
function init() {
    loadData();
    renderGenreTabs();
    renderTasks();
    updateDailySequence();
    renderMemos();
    updateHabitTracker();
    updateAnalysis();
    updateAIAdvice();
    loadGoals();
}

// ãƒ‡ãƒ¼ã‚¿ä¿å­˜/èª­ã¿è¾¼ã¿
function saveData() {
    const data = {
        tasks,
        genres,
        memos,
        dailyProgress,
        motivationLevel,
        lastSaved: new Date().toISOString()
    };
    localStorage.setItem('dreamNovelData', JSON.stringify(data));
    showNotification('ä¿å­˜å®Œäº†', 'ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
}

function loadData() {
    const saved = localStorage.getItem('dreamNovelData');
    if (saved) {
        const data = JSON.parse(saved);
        tasks = data.tasks || {};
        genres = data.genres || [];
        memos = data.memos || [];
        dailyProgress = data.dailyProgress || {};
        motivationLevel = data.motivationLevel || 75;
    } else {
        // åˆæœŸãƒ‡ãƒ¼ã‚¿
        genres = [
            { id: 'trick', name: 'TRICK', workCount: 0 },
            { id: 'killers', name: 'KILLERS', workCount: 0 }
        ];
        initializeTasks();
    }
}

// ã‚¿ã‚¹ã‚¯åˆæœŸåŒ–
function initializeTasks() {
    genres.forEach(genre => {
        tasks[genre.id] = [
            {
                id: `${genre.id}_1`,
                title: `${genre.name} ã‚»ãƒªãƒ•èµ·ã“ã—`,
                type: 'transcript',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: 'MakeMKVå‡¦ç†', completed: false },
                    { id: 2, title: 'HandBrakeå¤‰æ›', completed: false },
                    { id: 3, title: 'Nottaæ–‡å­—èµ·ã“ã—', completed: false }
                ]
            },
            {
                id: `${genre.id}_2`,
                title: `${genre.name} ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ†æ`,
                type: 'analysis',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: 'ä¸»äººå…¬ã®æ€§æ ¼åˆ†æ', completed: false },
                    { id: 2, title: 'ã‚µãƒ–ã‚­ãƒ£ãƒ©ã®å½¹å‰²æ•´ç†', completed: false },
                    { id: 3, title: 'é–¢ä¿‚æ€§ãƒãƒƒãƒ—ä½œæˆ', completed: false }
                ]
            },
            {
                id: `${genre.id}_3`,
                title: `${genre.name} ä¼ç·šå±•é–‹ãƒ•ã‚¡ã‚¤ãƒ«`,
                type: 'planning',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: 'ç¬¬1ç« æ§‹æˆ', completed: false },
                    { id: 2, title: 'ç¬¬2ç« æ§‹æˆ', completed: false },
                    { id: 3, title: 'ç¬¬3ç« æ§‹æˆ', completed: false }
                ]
            },
            {
                id: `${genre.id}_4`,
                title: `${genre.name} å¤¢å°èª¬åŸ·ç­†`,
                type: 'writing',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                chapters: 3,
                wordsPerEpisode: 8000,
                currentWords: 0,
                targetWords: 24000,
                subTasks: [
                    { id: 1, title: 'ç¬¬1ç« åŸ·ç­†', completed: false },
                    { id: 2, title: 'ç¬¬2ç« åŸ·ç­†', completed: false },
                    { id: 3, title: 'ç¬¬3ç« åŸ·ç­†', completed: false }
                ]
            }
        ];
    });
}

// ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ãƒ–è¡¨ç¤ºï¼ˆã‚ã„ã†ãˆãŠé †ï¼‰
function renderGenreTabs() {
    const container = document.getElementById('genreTabs');
    
    // ã‚ã„ã†ãˆãŠé †ã«ã‚½ãƒ¼ãƒˆ
    const sortedGenres = [...genres].sort((a, b) => 
        a.name.localeCompare(b.name, 'ja')
    );
    
    let html = '<div class="genre-tab active" onclick="selectGenre(\'all\')">å…¨ä½“</div>';
    
    sortedGenres.forEach(genre => {
        const isFrequent = genre.workCount > 10;
        html += `
            <div class="genre-tab" onclick="selectGenre('${genre.id}')" id="genre_${genre.id}">
                ${genre.name}
                ${isFrequent ? '<span class="sparkle">âœ¨</span>' : ''}
                <span class="genre-edit-btn" onclick="editGenre(event, '${genre.id}')">âœï¸</span>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ
function selectGenre(genreId) {
    document.querySelectorAll('.genre-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    if (genreId === 'all') {
        document.querySelector('.genre-tab').classList.add('active');
    } else {
        document.getElementById(`genre_${genreId}`).classList.add('active');
    }
    
    renderTasks(genreId);
}

// ã‚¸ãƒ£ãƒ³ãƒ«ç·¨é›†
function editGenre(event, genreId) {
    event.stopPropagation();
    currentEditGenreId = genreId;
    const genre = genres.find(g => g.id === genreId);
    
    document.getElementById('genreModalTitle').textContent = 'ã‚¸ãƒ£ãƒ³ãƒ«ç·¨é›†';
    document.getElementById('genreName').value = genre.name;
    document.getElementById('genreModal').style.display = 'flex';
}

// ã‚¸ãƒ£ãƒ³ãƒ«ä¿å­˜
function saveGenre() {
    const name = document.getElementById('genreName').value.trim();
    if (!name) return;
    
    if (currentEditGenreId) {
        // ç·¨é›†
        const genre = genres.find(g => g.id === currentEditGenreId);
        genre.name = name;
    } else {
        // æ–°è¦è¿½åŠ 
        const id = name.toLowerCase().replace(/\s+/g, '_');
        genres.push({ id, name, workCount: 0 });
        tasks[id] = [];
    }
    
    renderGenreTabs();
    saveData();
    closeModal('genreModal');
    currentEditGenreId = null;
}

// ã‚¿ã‚¹ã‚¯è¡¨ç¤º
function renderTasks(genreFilter = 'all') {
    const container = document.getElementById('taskList');
    let html = '';
    
    const genresToShow = genreFilter === 'all' ? genres : genres.filter(g => g.id === genreFilter);
    
    genresToShow.forEach(genre => {
        html += `
            <div style="margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: white;">${genre.name}</h3>
                    <button class="btn btn-success" onclick="showAddTaskModal('${genre.id}')">
                        + ã‚¿ã‚¹ã‚¯è¿½åŠ 
                    </button>
                </div>
                <div id="tasks_${genre.id}">
        `;
        
        // AIã§å„ªå…ˆé †ä½ä»˜ã‘ã—ã¦ã‚½ãƒ¼ãƒˆ
        const genreTasks = tasks[genre.id] || [];
        const sortedTasks = [...genreTasks].sort((a, b) => {
            if (a.priority && !b.priority) return -1;
            if (!a.priority && b.priority) return 1;
            return 0;
        });
        
        sortedTasks.forEach(task => {
            const isR18 = task.tags && task.tags.includes('R-18');
            const progressPercent = task.progress || 0;
            
            html += `
                <div class="task-card ${isR18 ? 'r18' : ''} ${task.priority ? 'priority' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTask('${task.id}')">
                            <div class="task-title" onclick="showTaskDetail('${task.id}')">
                                ${task.priority ? '<span class="priority-crown">ğŸ‘‘</span>' : ''}
                                ${task.title}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${task.completed ? `
                                <button class="btn btn-warning" onclick="undoComplete('${task.id}')">
                                    â†©ï¸ æˆ»ã™
                                </button>
                            ` : ''}
                            <button class="btn btn-danger" onclick="deleteTask('${task.id}')">
                                å‰Šé™¤
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%;">
                                <span class="progress-text">${Math.round(progressPercent)}%</span>
                            </div>
                        </div>
                    </div>
                    
                    ${task.subTasks ? `
                        <div class="subtask-container">
                            ${task.subTasks.map(sub => `
                                <div class="subtask-item ${sub.completed ? 'completed' : ''}">
                                    <input type="checkbox" ${sub.completed ? 'checked' : ''}
                                           onchange="toggleSubTask('${task.id}', ${sub.id})">
                                    <span>${sub.title}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${isR18 ? '<span class="tag r18">R-18</span>' : ''}
                </div>
            `;
        });
        
        html += '</div></div>';
    });
    
    container.innerHTML = html;
}

// ã‚¿ã‚¹ã‚¯å®Œäº†åˆ‡ã‚Šæ›¿ãˆ
function toggleTask(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            if (task.completed) {
                task.progress = 100;
                motivationLevel = Math.min(100, motivationLevel + 10);
                updateMotivation();
                
                // ä½œæ¥­ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
                const genre = genres.find(g => g.id === genreId);
                if (genre) genre.workCount++;
            }
        }
    });
    
    renderTasks();
    updateDailySequence();
    saveData();
    
    if (event.target.checked) {
        showNotification('ã‚¿ã‚¹ã‚¯å®Œäº†ï¼', 'ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ğŸ‰', 'success');
    }
}

// å®Œäº†å–ã‚Šæ¶ˆã—
function undoComplete(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            task.completed = false;
            task.progress = task.subTasks ? 
                (task.subTasks.filter(s => s.completed).length / task.subTasks.length * 100) : 0;
        }
    });
    
    renderTasks();
    updateDailySequence();
    saveData();
}

// ã‚µãƒ–ã‚¿ã‚¹ã‚¯åˆ‡ã‚Šæ›¿ãˆ
function toggleSubTask(taskId, subTaskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task && task.subTasks) {
            const subTask = task.subTasks.find(s => s.id === subTaskId);
            if (subTask) {
                subTask.completed = !subTask.completed;
                // é€²æ—æ›´æ–°
                const completedCount = task.subTasks.filter(s => s.completed).length;
                task.progress = (completedCount / task.subTasks.length) * 100;
            }
        }
    });
    
    renderTasks();
    saveData();
}

// ã‚¿ã‚¹ã‚¯è©³ç´°è¡¨ç¤º
function showTaskDetail(taskId) {
    let task = null;
    Object.keys(tasks).forEach(genreId => {
        const found = tasks[genreId].find(t => t.id === taskId);
        if (found) task = found;
    });
    
    if (!task) return;
    
    currentTaskId = taskId;
    document.getElementById('detailTitle').textContent = task.title;
    
    let html = `
        <div style="margin-bottom: 15px;">
            <strong>æœŸé–“:</strong> ${task.startDate} ã€œ ${task.endDate}<br>
            <strong>é€²æ—:</strong> ${Math.round(task.progress)}%<br>
            ${task.type === 'writing' ? `
                <strong>æ–‡å­—æ•°:</strong> ${task.currentWords || 0} / ${task.targetWords || 24000}æ–‡å­—<br>
            ` : ''}
        </div>
    `;
    
    if (task.subTasks) {
        html += '<div><strong>ã‚µãƒ–ã‚¿ã‚¹ã‚¯:</strong><ul>';
        task.subTasks.forEach(sub => {
            html += `<li style="${sub.completed ? 'text-decoration: line-through;' : ''}">${sub.title}</li>`;
        });
        html += '</ul></div>';
    }
    
    document.getElementById('detailContent').innerHTML = html;
    
    // åŠ±ã¾ã—ã®è¨€è‘‰
    const quotes = [
        "ä¸€æ­©ãšã¤é€²ã‚ã°ã€å¿…ãšç›®æ¨™ã«åˆ°é”ã§ãã¾ã™ï¼",
        "ä»Šæ—¥ã®åŠªåŠ›ãŒæ˜æ—¥ã®æˆåŠŸã‚’ä½œã‚Šã¾ã™ã€‚",
        "ã‚ãªãŸã®ç‰©èªã‚’ä¸–ç•ŒãŒå¾…ã£ã¦ã„ã¾ã™ï¼",
        "å®Œç’§ã˜ã‚ƒãªãã¦ã„ã„ã€ã¾ãšå§‹ã‚ã‚‹ã“ã¨ãŒå¤§åˆ‡ã€‚",
        "ä¼‘æ†©ã‚‚å¤§åˆ‡ã€‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼"
    ];
    document.getElementById('motivationalQuote').textContent = quotes[Math.floor(Math.random() * quotes.length)];
    
    document.getElementById('detailModal').style.display = 'flex';
}

// ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
function showAddTaskModal(genreId) {
    currentEditGenreId = genreId;
    const genre = genres.find(g => g.id === genreId);
    document.getElementById('taskModalTitle').textContent = `${genre.name} - ã‚¿ã‚¹ã‚¯è¿½åŠ `;
    
    // æ—¥ä»˜åˆæœŸå€¤
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('taskStartDate').value = today;
    document.getElementById('taskEndDate').value = today;
    
    document.getElementById('taskModal').style.display = 'flex';
}

// ã‚¿ã‚¹ã‚¯ä¿å­˜
function saveTask() {
    const task = {
        id: `task_${Date.now()}`,
        title: document.getElementById('taskTitle').value,
        type: document.getElementById('taskType').value,
        startDate: document.getElementById('taskStartDate').value,
        endDate: document.getElementById('taskEndDate').value,
        progress: 0,
        completed: false,
        priority: false,
        tags: [],
        subTasks: []
    };
    
    // ã‚¿ã‚°è¨­å®š
    if (document.getElementById('tagR18').checked) task.tags.push('R-18');
    if (document.getElementById('tagRomance').checked) task.tags.push('æ‹æ„›');
    if (document.getElementById('tagAction').checked) task.tags.push('ã‚¢ã‚¯ã‚·ãƒ§ãƒ³');
    if (document.getElementById('tagComedy').checked) task.tags.push('ã‚³ãƒ¡ãƒ‡ã‚£');
    
    // åŸ·ç­†ã‚¿ã‚¹ã‚¯ã®å ´åˆ
    if (task.type === 'writing') {
        const chapters = parseInt(document.getElementById('chapterCount').value) || 3;
        const wordsPerEpisode = parseInt(document.getElementById('wordsPerEpisode').value) || 8000;
        
        task.chapters = chapters;
        task.wordsPerEpisode = wordsPerEpisode;
        task.targetWords = chapters * 3 * wordsPerEpisode; // å„ç« 3è©±æƒ³å®š
        task.currentWords = 0;
        
        // ç« ã”ã¨ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯è‡ªå‹•ç”Ÿæˆ
        for (let i = 1; i <= chapters; i++) {
            task.subTasks.push({
                id: i,
                title: `ç¬¬${i}ç« åŸ·ç­†`,
                completed: false
            });
        }
    }
    
    // ã‚µãƒ–ã‚¿ã‚¹ã‚¯ï¼ˆè©³ç´°ã‹ã‚‰ç”Ÿæˆï¼‰
    const details = document.getElementById('taskDetails').value;
    if (details) {
        const lines = details.split('\n');
        lines.forEach((line, index) => {
            if (line.trim()) {
                task.subTasks.push({
                    id: task.subTasks.length + 1,
                    title: line.trim(),
                    completed: false
                });
            }
        });
    }
    
    tasks[currentEditGenreId].push(task);
    renderTasks();
    saveData();
    closeModal('taskModal');
    
    showNotification('ã‚¿ã‚¹ã‚¯è¿½åŠ ', 'æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
}

// ã‚¿ã‚¹ã‚¯å‰Šé™¤
function deleteTask(taskId) {
    if (!confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId] = tasks[genreId].filter(t => t.id !== taskId);
    });
    
    renderTasks();
    saveData();
}

// ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼
function startPomodoro() {
    pomodoroActive = true;
    document.getElementById('pomodoroStart').style.display = 'none';
    document.getElementById('pomodoroPause').style.display = 'inline-block';
    
    pomodoroInterval = setInterval(() => {
        if (pomodoroTime > 0) {
            pomodoroTime--;
            updatePomodoroDisplay();
        } else {
            completePomodoro();
        }
    }, 1000);
}

function pausePomodoro() {
    pomodoroActive = false;
    clearInterval(pomodoroInterval);
    document.getElementById('pomodoroStart').style.display = 'inline-block';
    document.getElementById('pomodoroPause').style.display = 'none';
}

function resetPomodoro() {
    pomodoroActive = false;
    clearInterval(pomodoroInterval);
    pomodoroTime = 25 * 60;
    updatePomodoroDisplay();
    document.getElementById('pomodoroStart').style.display = 'inline-block';
    document.getElementById('pomodoroPause').style.display = 'none';
}

function updatePomodoroDisplay() {
    const minutes = Math.floor(pomodoroTime / 60);
    const seconds = pomodoroTime % 60;
    document.getElementById('pomodoroTime').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function completePomodoro() {
    resetPomodoro();
    motivationLevel = Math.min(100, motivationLevel + 5);
    updateMotivation();
    
    // ä»Šæ—¥ã®é€²æ—æ›´æ–°
    const today = new Date().toISOString().split('T')[0];
    dailyProgress[today] = (dailyProgress[today] || 0) + 1;
    
    updateHabitTracker();
    saveData();
    showNotification('ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­å®Œäº†ï¼', '5åˆ†ä¼‘æ†©ã—ã¦ãã ã•ã„ ğŸ‰', 'success');
}

// ä»Šæ—¥ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ›´æ–°
function updateDailySequence() {
    const container = document.getElementById('dailySequence');
    let todayTasks = [];
    
    Object.keys(tasks).forEach(genreId => {
        todayTasks = todayTasks.concat(tasks[genreId]);
    });
    
    const total = todayTasks.length;
    const completed = todayTasks.filter(t => t.completed).length;
    
    let html = '';
    for (let i = 0; i < Math.min(total, 10); i++) {
        const isCompleted = i < completed;
        html += `
            <div class="sequence-segment ${isCompleted ? 'completed' : ''}">
                ${isCompleted ? 'âœ“' : ''}
            </div>
        `;
    }
    
    container.innerHTML = html;
    document.getElementById('completedToday').textContent = completed;
    document.getElementById('totalToday').textContent = total;
}

// æœˆé–“äºˆå®šè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
function toggleMonthlySchedule() {
    const schedule = document.getElementById('monthlySchedule');
    schedule.classList.toggle('expanded');
    
    if (schedule.classList.contains('expanded')) {
        renderMonthlySchedule();
    }
}

function renderMonthlySchedule() {
    const container = document.getElementById('monthlySchedule');
    const today = new Date();
    let html = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">';
    
    // 30æ—¥åˆ†è¡¨ç¤º
    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        
        let dayTasks = [];
        Object.keys(tasks).forEach(genreId => {
            tasks[genreId].forEach(task => {
                if (task.startDate <= dateStr && task.endDate >= dateStr) {
                    dayTasks.push(task);
                }
            });
        });
        
        html += `
            <div style="background: white; border-radius: 5px; padding: 5px; min-height: 60px;">
                <div style="font-size: 12px; font-weight: bold;">${date.getMonth()+1}/${date.getDate()}</div>
                <div style="font-size: 10px; color: #666;">
                    ${dayTasks.slice(0, 2).map(t => t.title.substring(0, 8)).join('<br>')}
                    ${dayTasks.length > 2 ? `<br>ä»–${dayTasks.length - 2}ä»¶` : ''}
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

// ãƒ¡ãƒ¢è¡¨ç¤º
function renderMemos() {
    const container = document.getElementById('memoList');
    
    if (memos.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
    }
    
    let html = '';
    memos.forEach(memo => {
        html += `
            <div class="memo-item" onclick="toggleMemo(${memo.id})">
                <div class="memo-title">${memo.title || 'ç„¡é¡Œ'}</div>
                <div class="memo-preview" id="memo_${memo.id}">
                    ${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}
                </div>
                <div style="margin-top: 10px; display: flex; gap: 5px;">
                    <button class="btn btn-primary" onclick="editMemo(event, ${memo.id})">ç·¨é›†</button>
                    <button class="btn btn-danger" onclick="deleteMemo(event, ${memo.id})">å‰Šé™¤</button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function toggleMemo(memoId) {
    const memo = memos.find(m => m.id === memoId);
    const preview = document.getElementById(`memo_${memoId}`);
    
    if (preview.classList.contains('expanded')) {
        preview.classList.remove('expanded');
        preview.innerHTML = `${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}`;
    } else {
        preview.classList.add('expanded');
        preview.innerHTML = memo.content;
    }
}

function showMemoModal() {
    currentEditMemoId = null;
    document.getElementById('memoModalTitle').textContent = 'ãƒ¡ãƒ¢ä½œæˆ';
    document.getElementById('memoTitle').value = '';
    document.getElementById('memoContent').value = '';
    
    // ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠè‚¢
    const select = document.getElementById('memoGenre');
    select.innerHTML = '<option value="">ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ</option>';
    genres.forEach(genre => {
        select.innerHTML += `<option value="${genre.id}">${genre.name}</option>`;
    });
    
    document.getElementById('memoModal').style.display = 'flex';
}

function editMemo(event, memoId) {
    event.stopPropagation();
    currentEditMemoId = memoId;
    const memo = memos.find(m => m.id === memoId);
    
    document.getElementById('memoModalTitle').textContent = 'ãƒ¡ãƒ¢ç·¨é›†';
    document.getElementById('memoTitle').value = memo.title || '';
    document.getElementById('memoContent').value = memo.content;
    document.getElementById('memoGenre').value = memo.genreId || '';
    
    document.getElementById('memoModal').style.display = 'flex';
}

function saveMemo() {
    const title = document.getElementById('memoTitle').value.trim();
    const content = document.getElementById('memoContent').value.trim();
    const genreId = document.getElementById('memoGenre').value;
    
    if (!content) return;
    
    if (currentEditMemoId) {
        // ç·¨é›†
        const memo = memos.find(m => m.id === currentEditMemoId);
        memo.title = title;
        memo.content = content;
        memo.genreId = genreId;
        memo.updatedAt = new Date().toISOString();
    } else {
        // æ–°è¦
        memos.unshift({
            id: Date.now(),
            title,
            content,
            genreId,
            createdAt: new Date().toISOString()
        });
    }
    
    renderMemos();
    saveData();
    closeModal('memoModal');
}

function deleteMemo(event, memoId) {
    event.stopPropagation();
    if (!confirm('ã“ã®ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    
    memos = memos.filter(m => m.id !== memoId);
    renderMemos();
    saveData();
}

// ãƒãƒ“ãƒƒãƒˆãƒˆãƒ©ãƒƒã‚«ãƒ¼æ›´æ–°
function updateHabitTracker() {
    const container = document.getElementById('habitGrid');
    const today = new Date();
    let html = '';
    
    // éå»7æ—¥åˆ†
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        const progress = dailyProgress[dateStr] || 0;
        
        let type = '';
        if (progress > 0) {
            // åˆ†æä½œæ¥­ã‹å‰µä½œä½œæ¥­ã‹ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®šï¼ˆå®Ÿéš›ã¯ä½œæ¥­ã‚¿ã‚¤ãƒ—ã§åˆ¤å®šï¼‰
            type = Math.random() > 0.5 ? 'analysis' : 'creation';
        }
        
        html += `
            <div class="habit-cell ${type}">
                <div>${date.getMonth()+1}/${date.getDate()}</div>
                ${progress > 0 ? `<div>${progress}ğŸ…</div>` : ''}
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// åˆ†ææ›´æ–°
function updateAnalysis() {
    const chart = document.getElementById('analysisChart');
    let analysisCount = 0;
    let creationCount = 0;
    
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId].forEach(task => {
            if (task.completed) {
                if (task.type === 'analysis' || task.type === 'transcript') {
                    analysisCount++;
                } else {
                    creationCount++;
                }
            }
        });
    });
    
    const total = analysisCount + creationCount;
    const analysisHeight = total > 0 ? (analysisCount / total * 100) : 0;
    const creationHeight = total > 0 ? (creationCount / total * 100) : 0;
    
    chart.innerHTML = `
        <div class="chart-bar" style="height: ${analysisHeight}%; background: linear-gradient(to top, #667eea, #764ba2);">
            åˆ†æ<br>${analysisCount}
        </div>
        <div class="chart-bar" style="height: ${creationHeight}%; background: linear-gradient(to top, #f093fb, #f5576c);">
            å‰µä½œ<br>${creationCount}
        </div>
    `;
    
    // AIã‚¢ãƒ‰ãƒã‚¤ã‚¹
    const advice = document.getElementById('analysisAdvice');
    if (analysisCount > creationCount) {
        advice.innerHTML = 'ğŸ“Š åˆ†æä½œæ¥­ãŒå¤šã‚ã§ã™ã€‚ãã‚ãã‚å‰µä½œã«ç§»ã‚Šã¾ã—ã‚‡ã†ï¼';
    } else if (creationCount > analysisCount) {
        advice.innerHTML = 'âœï¸ å‰µä½œãŒé †èª¿ã§ã™ï¼åˆ†æã‚‚å¿˜ã‚Œãšã«è¡Œã„ã¾ã—ã‚‡ã†ã€‚';
    } else {
        advice.innerHTML = 'âš–ï¸ ãƒãƒ©ãƒ³ã‚¹ã‚ˆãä½œæ¥­ã§ãã¦ã„ã¾ã™ï¼';
    }
}

// AIå„ªå…ˆã‚¿ã‚¹ã‚¯æ›´æ–°
function updateAIAdvice() {
    const container = document.getElementById('aiAdvice');
    let allTasks = [];
    
    Object.keys(tasks).forEach(genreId => {
        allTasks = allTasks.concat(tasks[genreId].filter(t => !t.completed));
    });
    
    // å„ªå…ˆåº¦è¨ˆç®—
    allTasks.forEach(task => {
        let score = 0;
        
        // æœŸé™ã®è¿‘ã•
        const daysLeft = Math.ceil((new Date(task.endDate) - new Date()) / (1000 * 60 * 60 * 24));
        if (daysLeft <= 1) score += 100;
        else if (daysLeft <= 3) score += 50;
        else if (daysLeft <= 7) score += 20;
        
        // é€²æ—ã®é…ã‚Œ
        if (task.progress < 30) score += 30;
        
        task.priorityScore = score;
    });
    
    // ã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆ
    allTasks.sort((a, b) => b.priorityScore - a.priorityScore);
    
    // ä¸Šä½3ã¤ã‚’å„ªå…ˆã‚¿ã‚¹ã‚¯ã¨ã—ã¦ãƒãƒ¼ã‚¯
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId].forEach(task => {
            task.priority = false;
        });
    });
    
    const topTasks = allTasks.slice(0, 3);
    topTasks.forEach(task => {
        task.priority = true;
    });
    
    // è¡¨ç¤º
    if (topTasks.length > 0) {
        let html = '';
        topTasks.forEach((task, index) => {
            html += `
                <div style="padding: 5px 0; cursor: pointer;" onclick="scrollToTask('${task.id}')">
                    <strong>ğŸ‘‘ #${index + 1}</strong> ${task.title}
                    <span style="font-size: 12px; color: #666;">
                        (æœŸé™: ${new Date(task.endDate).toLocaleDateString('ja-JP')})
                    </span>
                </div>
            `;
        });
        container.innerHTML = html;
    } else {
        container.innerHTML = 'ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã¾ã™ï¼ğŸ‰';
    }
}

// ã‚¿ã‚¹ã‚¯ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
function scrollToTask(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            selectGenre(genreId);
            setTimeout(() => {
                const element = document.querySelector(`[onclick="showTaskDetail('${taskId}')"]`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    element.parentElement.parentElement.style.animation = 'pulse 1s ease 3';
                }
            }, 100);
        }
    });
}

// ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
function updateMotivation() {
    document.getElementById('motivationBar').style.width = `${motivationLevel}%`;
    document.querySelector('#motivationBar .progress-text').textContent = `${motivationLevel}%`;
    
    let text = '';
    if (motivationLevel >= 90) text = 'ğŸ”¥ çµ¶å¥½èª¿ï¼';
    else if (motivationLevel >= 70) text = 'â­ ã„ã„æ„Ÿã˜ï¼';
    else if (motivationLevel >= 50) text = 'ğŸ’ª ãã®èª¿å­ï¼';
    else text = 'â˜• ä¼‘æ†©ã‚‚å¤§åˆ‡';
    
    document.getElementById('motivationText').textContent = text;
}

// ç›®æ¨™ä¿å­˜/èª­ã¿è¾¼ã¿
function saveDailyGoal() {
    const goal = document.getElementById('dailyGoal').value;
    localStorage.setItem('dailyGoal', goal);
}

function saveMonthlyGoal() {
    const goal = document.getElementById('monthlyGoal').value;
    localStorage.setItem('monthlyGoal', goal);
}

function loadGoals() {
    document.getElementById('dailyGoal').value = localStorage.getItem('dailyGoal') || '';
    document.getElementById('monthlyGoal').value = localStorage.getItem('monthlyGoal') || '';
}

// é€šçŸ¥è¡¨ç¤º
function showNotification(title, message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div style="font-size: 18px;">${type === 'success' ? 'âœ…' : 'âš ï¸'}</div>
        <div>
            <div style="font-weight: bold;">${title}</div>
            <div style="font-size: 12px;">${message}</div>
        </div>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }, 3000);
}

@keyframes slideOut {
    to { transform: translateX(400px); opacity: 0; }
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// ä½œæ¥­é–‹å§‹ï¼ˆè©³ç´°ã‹ã‚‰ï¼‰
function startTaskWork() {
    if (currentTaskId) {
        startPomodoro();
        closeModal('detailModal');
        showNotification('ä½œæ¥­é–‹å§‹', 'ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'success');
    }
}

// åˆæœŸåŒ–å®Ÿè¡Œ
window.addEventListener('DOMContentLoaded', init);

// è‡ªå‹•ä¿å­˜ï¼ˆ1åˆ†ã”ã¨ï¼‰
setInterval(saveData, 60000);
</script>

</body>
</html>
