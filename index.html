<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>夢小説創作ダッシュボード - 改善版</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 10px;
    overflow-x: hidden;
}

/* タッチフィードバック改善 */
button, .clickable, .task-title, .genre-tab, .memo-tab, input[type="checkbox"] {
    cursor: pointer;
    transition: all 0.2s ease;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

button:active, .clickable:active {
    transform: scale(0.95);
    opacity: 0.8;
}

button:hover, .clickable:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.task-title:hover {
    color: #667eea;
    text-decoration: underline;
}

/* チェックボックスの視覚改善 */
input[type="checkbox"] {
    width: 24px;
    height: 24px;
    cursor: pointer;
    position: relative;
}

input[type="checkbox"]:checked::after {
    content: '✓';
    position: absolute;
    top: 0;
    left: 4px;
    font-size: 18px;
    color: #48bb78;
    animation: checkmark 0.3s ease;
}

@keyframes checkmark {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

.header {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.title {
    font-size: 24px;
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* ジャンル関連のスタイル */
.genre-tab {
    padding: 10px 20px;
    background: #f0f0f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.genre-tab.active {
    background: #667eea;
    color: white;
    transform: scale(1.05);
}

.genre-tab .sparkle {
    position: absolute;
    top: -5px;
    right: -5px;
    font-size: 16px;
    animation: sparkle 1.5s infinite;
}

@keyframes sparkle {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

.genre-edit-btn {
    margin-left: 5px;
    padding: 2px 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
}

/* タスクカード改善 */
.task-card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    position: relative;
}

.task-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.task-card.r18 {
    background: linear-gradient(135deg, #fff 0%, #ffe0e0 100%);
    border-left: 5px solid #ff69b4;
}

.task-card.priority {
    border-top: 3px solid #ffd700;
}

.priority-crown {
    color: #ffd700;
    font-size: 18px;
    margin-right: 5px;
}

.task-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    padding: 5px;
    border-radius: 5px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
}

/* プログレスバー改善 */
.progress-container {
    margin: 10px 0;
}

.progress-bar {
    width: 100%;
    height: 20px;
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 5px;
}

.progress-text {
    color: white;
    font-size: 12px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

/* サブタスク改善 */
.subtask-container {
    background: #f9f9f9;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
}

.subtask-item {
    display: flex;
    align-items: center;
    padding: 8px;
    margin: 5px 0;
    background: white;
    border-radius: 5px;
    transition: all 0.2s ease;
}

.subtask-item:hover {
    background: #f0f9ff;
    transform: translateX(5px);
}

.subtask-item.completed {
    opacity: 0.6;
    text-decoration: line-through;
}

/* メモシステム改善 */
.memo-item {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.memo-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
}

.memo-title {
    font-weight: bold;
    font-size: 16px;
    color: #333;
    margin-bottom: 5px;
}

.memo-preview {
    color: #666;
    font-size: 14px;
    line-height: 1.4;
    max-height: 3em;
    overflow: hidden;
    text-overflow: ellipsis;
}

.memo-item.expanded .memo-preview {
    max-height: none;
}

/* ポモドーロタイマー改善 */
.pomodoro-controls {
    display: flex;
    gap: 10px;
    align-items: center;
}

.pomodoro-btn {
    padding: 8px 16px;
    border: none;
    border-radius: 25px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.pomodoro-btn.start {
    background: #48bb78;
    color: white;
}

.pomodoro-btn.pause {
    background: #ed8936;
    color: white;
}

.pomodoro-btn.reset {
    background: #f56565;
    color: white;
}

/* 今日のシーケンス */
.daily-sequence {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.sequence-bar {
    display: flex;
    gap: 2px;
    height: 30px;
    border-radius: 5px;
    overflow: hidden;
}

.sequence-segment {
    flex: 1;
    background: #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    transition: all 0.3s ease;
}

.sequence-segment.completed {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
}

/* ハビットトラッカー */
.habit-tracker {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
}

.habit-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    margin-top: 15px;
}

.habit-cell {
    aspect-ratio: 1;
    border-radius: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.habit-cell.analysis {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.habit-cell.creation {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
}

/* 月間予定表示 */
.monthly-schedule {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.5s ease;
}

.monthly-schedule.expanded {
    max-height: 1000px;
}

.schedule-toggle {
    background: #667eea;
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
}

/* 通知システム */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 10px;
    padding: 15px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    z-index: 10000;
    animation: slideIn 0.5s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.notification.success {
    border-left: 5px solid #48bb78;
}

.notification.error {
    border-left: 5px solid #f56565;
}

/* 目標設定 */
.goal-setting {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.goal-input {
    width: 100%;
    padding: 10px;
    border: 2px solid white;
    border-radius: 8px;
    font-size: 14px;
    margin-top: 10px;
}

/* モーダル改善 */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: white;
    border-radius: 15px;
    padding: 25px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    animation: scaleIn 0.3s ease;
}

@keyframes scaleIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* レスポンシブ対応 */
@media (max-width: 768px) {
    .title {
        font-size: 20px;
    }
    
    .genre-tab {
        padding: 8px 12px;
        font-size: 14px;
    }
    
    .task-card {
        padding: 12px;
    }
}

/* ボタン共通スタイル */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.btn-primary {
    background: #667eea;
    color: white;
}

.btn-success {
    background: #48bb78;
    color: white;
}

.btn-danger {
    background: #f56565;
    color: white;
}

.btn-warning {
    background: #ed8936;
    color: white;
}

.btn:active {
    transform: scale(0.95);
}

/* タグシステム */
.tag {
    display: inline-block;
    padding: 4px 10px;
    background: #e3f2fd;
    color: #1976d2;
    border-radius: 15px;
    font-size: 12px;
    margin: 2px;
}

.tag.r18 {
    background: #ffe0e0;
    color: #ff69b4;
    font-weight: bold;
}

/* 分析ダッシュボード */
.analysis-section {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
}

.analysis-chart {
    height: 200px;
    background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
    border-radius: 10px;
    display: flex;
    align-items: flex-end;
    padding: 10px;
    gap: 5px;
}

.chart-bar {
    flex: 1;
    background: linear-gradient(to top, #667eea, #764ba2);
    border-radius: 5px 5px 0 0;
    transition: all 0.3s ease;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    color: white;
    font-size: 10px;
    padding-bottom: 5px;
}

.chart-bar:hover {
    transform: scaleY(1.1);
}

input[type="text"], input[type="date"], input[type="number"], select, textarea {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: border-color 0.3s ease;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #667eea;
}

textarea {
    resize: vertical;
    min-height: 100px;
}
</style>
</head>
<body>

<div class="container">
    <!-- ヘッダー -->
    <div class="header">
        <div class="title">
            <span>✨</span>
            <span>夢小説創作ダッシュボード</span>
        </div>
        
        <!-- モチベーション＆ポモドーロ -->
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin: 20px 0;">
            <div>
                <div style="font-size: 14px; color: #666;">モチベーション</div>
                <div class="progress-bar" style="width: 200px;">
                    <div class="progress-fill" id="motivationBar" style="width: 75%;">
                        <span class="progress-text">75%</span>
                    </div>
                </div>
                <div id="motivationText" style="font-size: 12px; color: #888; margin-top: 5px;">⭐ いい感じ！</div>
            </div>
            
            <div style="background: #ffe0f0; padding: 10px 20px; border-radius: 25px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">🍅</span>
                    <span id="pomodoroTime" style="font-size: 20px; font-weight: bold;">25:00</span>
                    <div class="pomodoro-controls">
                        <button class="pomodoro-btn start" id="pomodoroStart" onclick="startPomodoro()">開始</button>
                        <button class="pomodoro-btn pause" id="pomodoroPause" onclick="pausePomodoro()" style="display: none;">一時停止</button>
                        <button class="pomodoro-btn reset" onclick="resetPomodoro()">リセット</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ジャンルタブ -->
        <div id="genreTabs" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
            <!-- 動的に生成 -->
        </div>
        <button class="btn btn-success" onclick="showAddGenreModal()" style="margin-top: 10px;">
            + ジャンル追加
        </button>
    </div>
    
    <!-- 目標設定 -->
    <div class="goal-setting">
        <h3 style="color: #333; margin-bottom: 10px;">🎯 今日の目標</h3>
        <input type="text" class="goal-input" id="dailyGoal" placeholder="例: TRICK第1章を完成させる" onchange="saveDailyGoal()">
        <div style="margin-top: 10px;">
            <h4 style="color: #333; font-size: 14px;">今月の目標</h4>
            <input type="text" class="goal-input" id="monthlyGoal" placeholder="例: 夢小説を3作品完成" onchange="saveMonthlyGoal()">
        </div>
    </div>
    
    <!-- 今日のシーケンス -->
    <div class="daily-sequence">
        <h3 style="color: #333; margin-bottom: 10px;">📊 今日の進捗シーケンス</h3>
        <div class="sequence-bar" id="dailySequence">
            <!-- 動的に生成 -->
        </div>
        <div style="margin-top: 10px; font-size: 14px; color: #666;">
            完了: <span id="completedToday">0</span> / <span id="totalToday">0</span> タスク
        </div>
    </div>
    
    <!-- 月間予定 -->
    <button class="schedule-toggle" onclick="toggleMonthlySchedule()">
        📅 1ヶ月の予定を表示
    </button>
    <div class="monthly-schedule" id="monthlySchedule">
        <!-- 動的に生成 -->
    </div>
    
    <!-- AI推奨タスク -->
    <div style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
        <h3 style="margin-bottom: 10px;">🤖 AI推奨: 優先タスク</h3>
        <div id="aiAdvice">
            <!-- 動的に生成 -->
        </div>
    </div>
    
    <!-- タスクリスト -->
    <div id="taskList">
        <!-- 動的に生成 -->
    </div>
    
    <!-- ハビットトラッカー -->
    <div class="habit-tracker">
        <h3 style="color: #333; margin-bottom: 10px;">📈 習慣化トラッカー</h3>
        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 3px;"></div>
                <span style="font-size: 14px;">分析作業</span>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
                <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 3px;"></div>
                <span style="font-size: 14px;">創作作業</span>
            </div>
        </div>
        <div class="habit-grid" id="habitGrid">
            <!-- 動的に生成 -->
        </div>
    </div>
    
    <!-- メモシステム -->
    <div style="background: white; border-radius: 15px; padding: 20px; margin-top: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="color: #333;">💡 アイデアメモ</h3>
            <button class="btn btn-primary" onclick="showMemoModal()">
                + 新規メモ
            </button>
        </div>
        <div id="memoList">
            <!-- 動的に生成 -->
        </div>
    </div>
    
    <!-- 分析ダッシュボード -->
    <div class="analysis-section">
        <h3 style="color: #333; margin-bottom: 15px;">📊 作業分析</h3>
        <div class="analysis-chart" id="analysisChart">
            <!-- 動的に生成 -->
        </div>
        <div id="analysisAdvice" style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px; font-size: 14px;">
            <!-- AIアドバイス -->
        </div>
    </div>
</div>

<!-- モーダル群 -->

<!-- ジャンル追加/編集モーダル -->
<div id="genreModal" class="modal">
    <div class="modal-content">
        <h3 id="genreModalTitle">ジャンル追加</h3>
        <input type="text" id="genreName" placeholder="ジャンル名を入力">
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveGenre()">保存</button>
            <button class="btn" onclick="closeModal('genreModal')" style="background: #ccc;">キャンセル</button>
        </div>
    </div>
</div>

<!-- タスク追加モーダル -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <h3 id="taskModalTitle">タスク追加</h3>
        <input type="text" id="taskTitle" placeholder="タスク名">
        <select id="taskType">
            <option value="transcript">セリフ起こし</option>
            <option value="analysis">分析</option>
            <option value="planning">伏線展開ファイル</option>
            <option value="writing">夢小説執筆</option>
        </select>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">章構成（執筆の場合）</label>
            <input type="number" id="chapterCount" value="3" min="1" max="10">
        </div>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">1話あたりの文字数</label>
            <input type="number" id="wordsPerEpisode" value="8000" min="1000">
        </div>
        
        <div style="margin: 10px 0;">
            <label style="font-size: 14px;">タグ</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 5px;">
                <label><input type="checkbox" id="tagR18"> R-18</label>
                <label><input type="checkbox" id="tagRomance"> 恋愛</label>
                <label><input type="checkbox" id="tagAction"> アクション</label>
                <label><input type="checkbox" id="tagComedy"> コメディ</label>
            </div>
        </div>
        
        <input type="date" id="taskStartDate">
        <input type="date" id="taskEndDate">
        <textarea id="taskDetails" placeholder="詳細（サブタスクは改行で区切る）"></textarea>
        
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveTask()">保存</button>
            <button class="btn" onclick="closeModal('taskModal')" style="background: #ccc;">キャンセル</button>
        </div>
    </div>
</div>

<!-- タスク詳細モーダル -->
<div id="detailModal" class="modal">
    <div class="modal-content">
        <h3 id="detailTitle">タスク詳細</h3>
        <div id="detailContent">
            <!-- 動的に生成 -->
        </div>
        <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center; font-style: italic;">
            <div id="motivationalQuote"></div>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="startTaskWork()">作業開始</button>
            <button class="btn" onclick="closeModal('detailModal')" style="background: #ccc;">閉じる</button>
        </div>
    </div>
</div>

<!-- メモ追加/編集モーダル -->
<div id="memoModal" class="modal">
    <div class="modal-content">
        <h3 id="memoModalTitle">メモ作成</h3>
        <input type="text" id="memoTitle" placeholder="タイトル">
        <textarea id="memoContent" placeholder="内容"></textarea>
        <select id="memoGenre">
            <option value="">ジャンル選択</option>
        </select>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" onclick="saveMemo()">保存</button>
            <button class="btn" onclick="closeModal('memoModal')" style="background: #ccc;">キャンセル</button>
        </div>
    </div>
</div>

<script>
// グローバル変数
let tasks = {};
let genres = [];
let memos = [];
let dailyProgress = {};
let pomodoroTime = 25 * 60;
let pomodoroActive = false;
let pomodoroInterval = null;
let currentTaskId = null;
let currentEditGenreId = null;
let currentEditMemoId = null;
let motivationLevel = 75;

// 初期化
function init() {
    loadData();
    renderGenreTabs();
    renderTasks();
    updateDailySequence();
    renderMemos();
    updateHabitTracker();
    updateAnalysis();
    updateAIAdvice();
    loadGoals();
}

// データ保存/読み込み
function saveData() {
    const data = {
        tasks,
        genres,
        memos,
        dailyProgress,
        motivationLevel,
        lastSaved: new Date().toISOString()
    };
    localStorage.setItem('dreamNovelData', JSON.stringify(data));
    showNotification('保存完了', 'データを保存しました');
}

function loadData() {
    const saved = localStorage.getItem('dreamNovelData');
    if (saved) {
        const data = JSON.parse(saved);
        tasks = data.tasks || {};
        genres = data.genres || [];
        memos = data.memos || [];
        dailyProgress = data.dailyProgress || {};
        motivationLevel = data.motivationLevel || 75;
    } else {
        // 初期データ
        genres = [
            { id: 'trick', name: 'TRICK', workCount: 0 },
            { id: 'killers', name: 'KILLERS', workCount: 0 }
        ];
        initializeTasks();
    }
}

// タスク初期化
function initializeTasks() {
    genres.forEach(genre => {
        tasks[genre.id] = [
            {
                id: `${genre.id}_1`,
                title: `${genre.name} セリフ起こし`,
                type: 'transcript',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: 'MakeMKV処理', completed: false },
                    { id: 2, title: 'HandBrake変換', completed: false },
                    { id: 3, title: 'Notta文字起こし', completed: false }
                ]
            },
            {
                id: `${genre.id}_2`,
                title: `${genre.name} キャラクター分析`,
                type: 'analysis',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 4 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: '主人公の性格分析', completed: false },
                    { id: 2, title: 'サブキャラの役割整理', completed: false },
                    { id: 3, title: '関係性マップ作成', completed: false }
                ]
            },
            {
                id: `${genre.id}_3`,
                title: `${genre.name} 伏線展開ファイル`,
                type: 'planning',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 6 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                subTasks: [
                    { id: 1, title: '第1章構成', completed: false },
                    { id: 2, title: '第2章構成', completed: false },
                    { id: 3, title: '第3章構成', completed: false }
                ]
            },
            {
                id: `${genre.id}_4`,
                title: `${genre.name} 夢小説執筆`,
                type: 'writing',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                progress: 0,
                completed: false,
                priority: false,
                tags: [],
                chapters: 3,
                wordsPerEpisode: 8000,
                currentWords: 0,
                targetWords: 24000,
                subTasks: [
                    { id: 1, title: '第1章執筆', completed: false },
                    { id: 2, title: '第2章執筆', completed: false },
                    { id: 3, title: '第3章執筆', completed: false }
                ]
            }
        ];
    });
}

// ジャンルタブ表示（あいうえお順）
function renderGenreTabs() {
    const container = document.getElementById('genreTabs');
    
    // あいうえお順にソート
    const sortedGenres = [...genres].sort((a, b) => 
        a.name.localeCompare(b.name, 'ja')
    );
    
    let html = '<div class="genre-tab active" onclick="selectGenre(\'all\')">全体</div>';
    
    sortedGenres.forEach(genre => {
        const isFrequent = genre.workCount > 10;
        html += `
            <div class="genre-tab" onclick="selectGenre('${genre.id}')" id="genre_${genre.id}">
                ${genre.name}
                ${isFrequent ? '<span class="sparkle">✨</span>' : ''}
                <span class="genre-edit-btn" onclick="editGenre(event, '${genre.id}')">✏️</span>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// ジャンル選択
function selectGenre(genreId) {
    document.querySelectorAll('.genre-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    if (genreId === 'all') {
        document.querySelector('.genre-tab').classList.add('active');
    } else {
        document.getElementById(`genre_${genreId}`).classList.add('active');
    }
    
    renderTasks(genreId);
}

// ジャンル編集
function editGenre(event, genreId) {
    event.stopPropagation();
    currentEditGenreId = genreId;
    const genre = genres.find(g => g.id === genreId);
    
    document.getElementById('genreModalTitle').textContent = 'ジャンル編集';
    document.getElementById('genreName').value = genre.name;
    document.getElementById('genreModal').style.display = 'flex';
}

// ジャンル保存
function saveGenre() {
    const name = document.getElementById('genreName').value.trim();
    if (!name) return;
    
    if (currentEditGenreId) {
        // 編集
        const genre = genres.find(g => g.id === currentEditGenreId);
        genre.name = name;
    } else {
        // 新規追加
        const id = name.toLowerCase().replace(/\s+/g, '_');
        genres.push({ id, name, workCount: 0 });
        tasks[id] = [];
    }
    
    renderGenreTabs();
    saveData();
    closeModal('genreModal');
    currentEditGenreId = null;
}

// タスク表示
function renderTasks(genreFilter = 'all') {
    const container = document.getElementById('taskList');
    let html = '';
    
    const genresToShow = genreFilter === 'all' ? genres : genres.filter(g => g.id === genreFilter);
    
    genresToShow.forEach(genre => {
        html += `
            <div style="margin: 20px 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: white;">${genre.name}</h3>
                    <button class="btn btn-success" onclick="showAddTaskModal('${genre.id}')">
                        + タスク追加
                    </button>
                </div>
                <div id="tasks_${genre.id}">
        `;
        
        // AIで優先順位付けしてソート
        const genreTasks = tasks[genre.id] || [];
        const sortedTasks = [...genreTasks].sort((a, b) => {
            if (a.priority && !b.priority) return -1;
            if (!a.priority && b.priority) return 1;
            return 0;
        });
        
        sortedTasks.forEach(task => {
            const isR18 = task.tags && task.tags.includes('R-18');
            const progressPercent = task.progress || 0;
            
            html += `
                <div class="task-card ${isR18 ? 'r18' : ''} ${task.priority ? 'priority' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                   onchange="toggleTask('${task.id}')">
                            <div class="task-title" onclick="showTaskDetail('${task.id}')">
                                ${task.priority ? '<span class="priority-crown">👑</span>' : ''}
                                ${task.title}
                            </div>
                        </div>
                        <div style="display: flex; gap: 5px;">
                            ${task.completed ? `
                                <button class="btn btn-warning" onclick="undoComplete('${task.id}')">
                                    ↩️ 戻す
                                </button>
                            ` : ''}
                            <button class="btn btn-danger" onclick="deleteTask('${task.id}')">
                                削除
                            </button>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%;">
                                <span class="progress-text">${Math.round(progressPercent)}%</span>
                            </div>
                        </div>
                    </div>
                    
                    ${task.subTasks ? `
                        <div class="subtask-container">
                            ${task.subTasks.map(sub => `
                                <div class="subtask-item ${sub.completed ? 'completed' : ''}">
                                    <input type="checkbox" ${sub.completed ? 'checked' : ''}
                                           onchange="toggleSubTask('${task.id}', ${sub.id})">
                                    <span>${sub.title}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${isR18 ? '<span class="tag r18">R-18</span>' : ''}
                </div>
            `;
        });
        
        html += '</div></div>';
    });
    
    container.innerHTML = html;
}

// タスク完了切り替え
function toggleTask(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            if (task.completed) {
                task.progress = 100;
                motivationLevel = Math.min(100, motivationLevel + 10);
                updateMotivation();
                
                // 作業カウント増加
                const genre = genres.find(g => g.id === genreId);
                if (genre) genre.workCount++;
            }
        }
    });
    
    renderTasks();
    updateDailySequence();
    saveData();
    
    if (event.target.checked) {
        showNotification('タスク完了！', 'お疲れ様でした！🎉', 'success');
    }
}

// 完了取り消し
function undoComplete(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            task.completed = false;
            task.progress = task.subTasks ? 
                (task.subTasks.filter(s => s.completed).length / task.subTasks.length * 100) : 0;
        }
    });
    
    renderTasks();
    updateDailySequence();
    saveData();
}

// サブタスク切り替え
function toggleSubTask(taskId, subTaskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task && task.subTasks) {
            const subTask = task.subTasks.find(s => s.id === subTaskId);
            if (subTask) {
                subTask.completed = !subTask.completed;
                // 進捗更新
                const completedCount = task.subTasks.filter(s => s.completed).length;
                task.progress = (completedCount / task.subTasks.length) * 100;
            }
        }
    });
    
    renderTasks();
    saveData();
}

// タスク詳細表示
function showTaskDetail(taskId) {
    let task = null;
    Object.keys(tasks).forEach(genreId => {
        const found = tasks[genreId].find(t => t.id === taskId);
        if (found) task = found;
    });
    
    if (!task) return;
    
    currentTaskId = taskId;
    document.getElementById('detailTitle').textContent = task.title;
    
    let html = `
        <div style="margin-bottom: 15px;">
            <strong>期間:</strong> ${task.startDate} 〜 ${task.endDate}<br>
            <strong>進捗:</strong> ${Math.round(task.progress)}%<br>
            ${task.type === 'writing' ? `
                <strong>文字数:</strong> ${task.currentWords || 0} / ${task.targetWords || 24000}文字<br>
            ` : ''}
        </div>
    `;
    
    if (task.subTasks) {
        html += '<div><strong>サブタスク:</strong><ul>';
        task.subTasks.forEach(sub => {
            html += `<li style="${sub.completed ? 'text-decoration: line-through;' : ''}">${sub.title}</li>`;
        });
        html += '</ul></div>';
    }
    
    document.getElementById('detailContent').innerHTML = html;
    
    // 励ましの言葉
    const quotes = [
        "一歩ずつ進めば、必ず目標に到達できます！",
        "今日の努力が明日の成功を作ります。",
        "あなたの物語を世界が待っています！",
        "完璧じゃなくていい、まず始めることが大切。",
        "休憩も大切。リフレッシュして頑張りましょう！"
    ];
    document.getElementById('motivationalQuote').textContent = quotes[Math.floor(Math.random() * quotes.length)];
    
    document.getElementById('detailModal').style.display = 'flex';
}

// タスク追加モーダル表示
function showAddTaskModal(genreId) {
    currentEditGenreId = genreId;
    const genre = genres.find(g => g.id === genreId);
    document.getElementById('taskModalTitle').textContent = `${genre.name} - タスク追加`;
    
    // 日付初期値
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('taskStartDate').value = today;
    document.getElementById('taskEndDate').value = today;
    
    document.getElementById('taskModal').style.display = 'flex';
}

// タスク保存
function saveTask() {
    const task = {
        id: `task_${Date.now()}`,
        title: document.getElementById('taskTitle').value,
        type: document.getElementById('taskType').value,
        startDate: document.getElementById('taskStartDate').value,
        endDate: document.getElementById('taskEndDate').value,
        progress: 0,
        completed: false,
        priority: false,
        tags: [],
        subTasks: []
    };
    
    // タグ設定
    if (document.getElementById('tagR18').checked) task.tags.push('R-18');
    if (document.getElementById('tagRomance').checked) task.tags.push('恋愛');
    if (document.getElementById('tagAction').checked) task.tags.push('アクション');
    if (document.getElementById('tagComedy').checked) task.tags.push('コメディ');
    
    // 執筆タスクの場合
    if (task.type === 'writing') {
        const chapters = parseInt(document.getElementById('chapterCount').value) || 3;
        const wordsPerEpisode = parseInt(document.getElementById('wordsPerEpisode').value) || 8000;
        
        task.chapters = chapters;
        task.wordsPerEpisode = wordsPerEpisode;
        task.targetWords = chapters * 3 * wordsPerEpisode; // 各章3話想定
        task.currentWords = 0;
        
        // 章ごとのサブタスク自動生成
        for (let i = 1; i <= chapters; i++) {
            task.subTasks.push({
                id: i,
                title: `第${i}章執筆`,
                completed: false
            });
        }
    }
    
    // サブタスク（詳細から生成）
    const details = document.getElementById('taskDetails').value;
    if (details) {
        const lines = details.split('\n');
        lines.forEach((line, index) => {
            if (line.trim()) {
                task.subTasks.push({
                    id: task.subTasks.length + 1,
                    title: line.trim(),
                    completed: false
                });
            }
        });
    }
    
    tasks[currentEditGenreId].push(task);
    renderTasks();
    saveData();
    closeModal('taskModal');
    
    showNotification('タスク追加', '新しいタスクを追加しました', 'success');
}

// タスク削除
function deleteTask(taskId) {
    if (!confirm('このタスクを削除しますか？')) return;
    
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId] = tasks[genreId].filter(t => t.id !== taskId);
    });
    
    renderTasks();
    saveData();
}

// ポモドーロタイマー
function startPomodoro() {
    pomodoroActive = true;
    document.getElementById('pomodoroStart').style.display = 'none';
    document.getElementById('pomodoroPause').style.display = 'inline-block';
    
    pomodoroInterval = setInterval(() => {
        if (pomodoroTime > 0) {
            pomodoroTime--;
            updatePomodoroDisplay();
        } else {
            completePomodoro();
        }
    }, 1000);
}

function pausePomodoro() {
    pomodoroActive = false;
    clearInterval(pomodoroInterval);
    document.getElementById('pomodoroStart').style.display = 'inline-block';
    document.getElementById('pomodoroPause').style.display = 'none';
}

function resetPomodoro() {
    pomodoroActive = false;
    clearInterval(pomodoroInterval);
    pomodoroTime = 25 * 60;
    updatePomodoroDisplay();
    document.getElementById('pomodoroStart').style.display = 'inline-block';
    document.getElementById('pomodoroPause').style.display = 'none';
}

function updatePomodoroDisplay() {
    const minutes = Math.floor(pomodoroTime / 60);
    const seconds = pomodoroTime % 60;
    document.getElementById('pomodoroTime').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

function completePomodoro() {
    resetPomodoro();
    motivationLevel = Math.min(100, motivationLevel + 5);
    updateMotivation();
    
    // 今日の進捗更新
    const today = new Date().toISOString().split('T')[0];
    dailyProgress[today] = (dailyProgress[today] || 0) + 1;
    
    updateHabitTracker();
    saveData();
    showNotification('ポモドーロ完了！', '5分休憩してください 🎉', 'success');
}

// 今日のシーケンス更新
function updateDailySequence() {
    const container = document.getElementById('dailySequence');
    let todayTasks = [];
    
    Object.keys(tasks).forEach(genreId => {
        todayTasks = todayTasks.concat(tasks[genreId]);
    });
    
    const total = todayTasks.length;
    const completed = todayTasks.filter(t => t.completed).length;
    
    let html = '';
    for (let i = 0; i < Math.min(total, 10); i++) {
        const isCompleted = i < completed;
        html += `
            <div class="sequence-segment ${isCompleted ? 'completed' : ''}">
                ${isCompleted ? '✓' : ''}
            </div>
        `;
    }
    
    container.innerHTML = html;
    document.getElementById('completedToday').textContent = completed;
    document.getElementById('totalToday').textContent = total;
}

// 月間予定表示切り替え
function toggleMonthlySchedule() {
    const schedule = document.getElementById('monthlySchedule');
    schedule.classList.toggle('expanded');
    
    if (schedule.classList.contains('expanded')) {
        renderMonthlySchedule();
    }
}

function renderMonthlySchedule() {
    const container = document.getElementById('monthlySchedule');
    const today = new Date();
    let html = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">';
    
    // 30日分表示
    for (let i = 0; i < 30; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        const dateStr = date.toISOString().split('T')[0];
        
        let dayTasks = [];
        Object.keys(tasks).forEach(genreId => {
            tasks[genreId].forEach(task => {
                if (task.startDate <= dateStr && task.endDate >= dateStr) {
                    dayTasks.push(task);
                }
            });
        });
        
        html += `
            <div style="background: white; border-radius: 5px; padding: 5px; min-height: 60px;">
                <div style="font-size: 12px; font-weight: bold;">${date.getMonth()+1}/${date.getDate()}</div>
                <div style="font-size: 10px; color: #666;">
                    ${dayTasks.slice(0, 2).map(t => t.title.substring(0, 8)).join('<br>')}
                    ${dayTasks.length > 2 ? `<br>他${dayTasks.length - 2}件` : ''}
                </div>
            </div>
        `;
    }
    
    html += '</div>';
    container.innerHTML = html;
}

// メモ表示
function renderMemos() {
    const container = document.getElementById('memoList');
    
    if (memos.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">メモがありません</div>';
        return;
    }
    
    let html = '';
    memos.forEach(memo => {
        html += `
            <div class="memo-item" onclick="toggleMemo(${memo.id})">
                <div class="memo-title">${memo.title || '無題'}</div>
                <div class="memo-preview" id="memo_${memo.id}">
                    ${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}
                </div>
                <div style="margin-top: 10px; display: flex; gap: 5px;">
                    <button class="btn btn-primary" onclick="editMemo(event, ${memo.id})">編集</button>
                    <button class="btn btn-danger" onclick="deleteMemo(event, ${memo.id})">削除</button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

function toggleMemo(memoId) {
    const memo = memos.find(m => m.id === memoId);
    const preview = document.getElementById(`memo_${memoId}`);
    
    if (preview.classList.contains('expanded')) {
        preview.classList.remove('expanded');
        preview.innerHTML = `${memo.content.substring(0, 100)}${memo.content.length > 100 ? '...' : ''}`;
    } else {
        preview.classList.add('expanded');
        preview.innerHTML = memo.content;
    }
}

function showMemoModal() {
    currentEditMemoId = null;
    document.getElementById('memoModalTitle').textContent = 'メモ作成';
    document.getElementById('memoTitle').value = '';
    document.getElementById('memoContent').value = '';
    
    // ジャンル選択肢
    const select = document.getElementById('memoGenre');
    select.innerHTML = '<option value="">ジャンル選択</option>';
    genres.forEach(genre => {
        select.innerHTML += `<option value="${genre.id}">${genre.name}</option>`;
    });
    
    document.getElementById('memoModal').style.display = 'flex';
}

function editMemo(event, memoId) {
    event.stopPropagation();
    currentEditMemoId = memoId;
    const memo = memos.find(m => m.id === memoId);
    
    document.getElementById('memoModalTitle').textContent = 'メモ編集';
    document.getElementById('memoTitle').value = memo.title || '';
    document.getElementById('memoContent').value = memo.content;
    document.getElementById('memoGenre').value = memo.genreId || '';
    
    document.getElementById('memoModal').style.display = 'flex';
}

function saveMemo() {
    const title = document.getElementById('memoTitle').value.trim();
    const content = document.getElementById('memoContent').value.trim();
    const genreId = document.getElementById('memoGenre').value;
    
    if (!content) return;
    
    if (currentEditMemoId) {
        // 編集
        const memo = memos.find(m => m.id === currentEditMemoId);
        memo.title = title;
        memo.content = content;
        memo.genreId = genreId;
        memo.updatedAt = new Date().toISOString();
    } else {
        // 新規
        memos.unshift({
            id: Date.now(),
            title,
            content,
            genreId,
            createdAt: new Date().toISOString()
        });
    }
    
    renderMemos();
    saveData();
    closeModal('memoModal');
}

function deleteMemo(event, memoId) {
    event.stopPropagation();
    if (!confirm('このメモを削除しますか？')) return;
    
    memos = memos.filter(m => m.id !== memoId);
    renderMemos();
    saveData();
}

// ハビットトラッカー更新
function updateHabitTracker() {
    const container = document.getElementById('habitGrid');
    const today = new Date();
    let html = '';
    
    // 過去7日分
    for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        const progress = dailyProgress[dateStr] || 0;
        
        let type = '';
        if (progress > 0) {
            // 分析作業か創作作業かランダムに決定（実際は作業タイプで判定）
            type = Math.random() > 0.5 ? 'analysis' : 'creation';
        }
        
        html += `
            <div class="habit-cell ${type}">
                <div>${date.getMonth()+1}/${date.getDate()}</div>
                ${progress > 0 ? `<div>${progress}🍅</div>` : ''}
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// 分析更新
function updateAnalysis() {
    const chart = document.getElementById('analysisChart');
    let analysisCount = 0;
    let creationCount = 0;
    
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId].forEach(task => {
            if (task.completed) {
                if (task.type === 'analysis' || task.type === 'transcript') {
                    analysisCount++;
                } else {
                    creationCount++;
                }
            }
        });
    });
    
    const total = analysisCount + creationCount;
    const analysisHeight = total > 0 ? (analysisCount / total * 100) : 0;
    const creationHeight = total > 0 ? (creationCount / total * 100) : 0;
    
    chart.innerHTML = `
        <div class="chart-bar" style="height: ${analysisHeight}%; background: linear-gradient(to top, #667eea, #764ba2);">
            分析<br>${analysisCount}
        </div>
        <div class="chart-bar" style="height: ${creationHeight}%; background: linear-gradient(to top, #f093fb, #f5576c);">
            創作<br>${creationCount}
        </div>
    `;
    
    // AIアドバイス
    const advice = document.getElementById('analysisAdvice');
    if (analysisCount > creationCount) {
        advice.innerHTML = '📊 分析作業が多めです。そろそろ創作に移りましょう！';
    } else if (creationCount > analysisCount) {
        advice.innerHTML = '✍️ 創作が順調です！分析も忘れずに行いましょう。';
    } else {
        advice.innerHTML = '⚖️ バランスよく作業できています！';
    }
}

// AI優先タスク更新
function updateAIAdvice() {
    const container = document.getElementById('aiAdvice');
    let allTasks = [];
    
    Object.keys(tasks).forEach(genreId => {
        allTasks = allTasks.concat(tasks[genreId].filter(t => !t.completed));
    });
    
    // 優先度計算
    allTasks.forEach(task => {
        let score = 0;
        
        // 期限の近さ
        const daysLeft = Math.ceil((new Date(task.endDate) - new Date()) / (1000 * 60 * 60 * 24));
        if (daysLeft <= 1) score += 100;
        else if (daysLeft <= 3) score += 50;
        else if (daysLeft <= 7) score += 20;
        
        // 進捗の遅れ
        if (task.progress < 30) score += 30;
        
        task.priorityScore = score;
    });
    
    // スコア順にソート
    allTasks.sort((a, b) => b.priorityScore - a.priorityScore);
    
    // 上位3つを優先タスクとしてマーク
    Object.keys(tasks).forEach(genreId => {
        tasks[genreId].forEach(task => {
            task.priority = false;
        });
    });
    
    const topTasks = allTasks.slice(0, 3);
    topTasks.forEach(task => {
        task.priority = true;
    });
    
    // 表示
    if (topTasks.length > 0) {
        let html = '';
        topTasks.forEach((task, index) => {
            html += `
                <div style="padding: 5px 0; cursor: pointer;" onclick="scrollToTask('${task.id}')">
                    <strong>👑 #${index + 1}</strong> ${task.title}
                    <span style="font-size: 12px; color: #666;">
                        (期限: ${new Date(task.endDate).toLocaleDateString('ja-JP')})
                    </span>
                </div>
            `;
        });
        container.innerHTML = html;
    } else {
        container.innerHTML = 'すべてのタスクが完了しています！🎉';
    }
}

// タスクへスクロール
function scrollToTask(taskId) {
    Object.keys(tasks).forEach(genreId => {
        const task = tasks[genreId].find(t => t.id === taskId);
        if (task) {
            selectGenre(genreId);
            setTimeout(() => {
                const element = document.querySelector(`[onclick="showTaskDetail('${taskId}')"]`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    element.parentElement.parentElement.style.animation = 'pulse 1s ease 3';
                }
            }, 100);
        }
    });
}

// モチベーション更新
function updateMotivation() {
    document.getElementById('motivationBar').style.width = `${motivationLevel}%`;
    document.querySelector('#motivationBar .progress-text').textContent = `${motivationLevel}%`;
    
    let text = '';
    if (motivationLevel >= 90) text = '🔥 絶好調！';
    else if (motivationLevel >= 70) text = '⭐ いい感じ！';
    else if (motivationLevel >= 50) text = '💪 その調子！';
    else text = '☕ 休憩も大切';
    
    document.getElementById('motivationText').textContent = text;
}

// 目標保存/読み込み
function saveDailyGoal() {
    const goal = document.getElementById('dailyGoal').value;
    localStorage.setItem('dailyGoal', goal);
}

function saveMonthlyGoal() {
    const goal = document.getElementById('monthlyGoal').value;
    localStorage.setItem('monthlyGoal', goal);
}

function loadGoals() {
    document.getElementById('dailyGoal').value = localStorage.getItem('dailyGoal') || '';
    document.getElementById('monthlyGoal').value = localStorage.getItem('monthlyGoal') || '';
}

// 通知表示
function showNotification(title, message, type = 'success') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div style="font-size: 18px;">${type === 'success' ? '✅' : '⚠️'}</div>
        <div>
            <div style="font-weight: bold;">${title}</div>
            <div style="font-size: 12px;">${message}</div>
        </div>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.5s ease';
        setTimeout(() => notification.remove(), 500);
    }, 3000);
}

@keyframes slideOut {
    to { transform: translateX(400px); opacity: 0; }
}

// モーダル閉じる
function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

// 作業開始（詳細から）
function startTaskWork() {
    if (currentTaskId) {
        startPomodoro();
        closeModal('detailModal');
        showNotification('作業開始', 'ポモドーロタイマーを開始しました', 'success');
    }
}

// 初期化実行
window.addEventListener('DOMContentLoaded', init);

// 自動保存（1分ごと）
setInterval(saveData, 60000);
</script>

</body>
</html>
